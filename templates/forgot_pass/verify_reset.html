{% extends "layout.html" %}


{% block content %} 



    <div id="container" style="position: relative;">
                            
        <div id="logo">
            <img src="./static/assests/favicon.png" alt="logo" style="width: 150px;height: 150px; border-radius: 100px;position: relative;">
                    
        </div>
                <div id="box_login">

                    <h2 style = "font-family:mcregular;color:white;position:absolute;top:120px;font-size:large">Enter the OTP sent to your email to reset :</h2>
                    <form>
                    <input type="text" name="otp" placeholder="Enter OTP" required style="height:30px;position:relative;top:90px" id="otpvalue"> 
                    <button type="button" style="font-family:mcregular;position:absolute;right:50px;background-color:black;color:red;top:55%" id="verify">Verify</button>
                    </form>
                    
                  
    
    
                </div>
    
        
    
    </div>

{% endblock %}


{% block script %}

<script>
    
//checking otp validation

const otpstatus = document.getElementById("verify")

async function handle_otp(){
    const otpvalue = document.getElementById("otpvalue")
    if (!otpvalue) {
        console.warn("otpvalue not found. Skipping handle_otp()");
        return;
    }
    const getval = otpvalue.value

    console.log("running")
    const res = await fetch("/verify-otp",{   // this is a classic request structure of JS. 
        method :  "POST",  // request type
        headers: {
            "Content-Type": "application/json"   // content type
          },
        body: JSON.stringify({ otp: getval }) // stringify is gonna covert th json object into a JSON string
    })

    const data = await res.json()
    console.log(data)

    if (data.status === "fail"){
        window.alert(`${data.message} try again!`)
        window.location.href = "/";

    }

    else{
        window.location.href = "/password_box_reset";
      

    }

}

const otp_element = document.getElementById("otpvalue")

if(otp_element){
    otp_element.addEventListener("keydown",(e)=>{
        if(e.key == "Enter"){
            handle_otp()
        }
    })
}


if(otpstatus){
    otpstatus.addEventListener('click',()=>{
        handle_otp()
    })
}

</script>

{% endblock %}